.. _benchmarking:

Замеры скорости работы
======================

Чтобы улучшать скорость работы pymorphy2 (оптимизируя структуры данных,
алгоритмы или реализацию), нужны какие-то надежные средства
для замеров производительность.

.. warning::

    Описанные в этом разделе штуки еще не реализованы.

На каких данных измерять?
-------------------------

Самый очевидный способ - выполнить интересующую операцию pymorphy2 для
всех слов из какого-то большого текста или корпуса. Это полезная метрика,
которая позволяет оценить среднюю скорость разбора. Минусы - зависимость
от конкретного корпуса, необходимость этот корпус распространять.

В pymorphy2 для замеров этого типа вместо корпуса целиком используются
частотные списки униграмм из OpenCorpora_: для каждого слова
разбор можно выполняеть столько раз, сколько оно встречалось
в корпусе.

.. _OpenCorpora: http://opencorpora.org/?page=downloads

Организация замеров производительности в pymorphy2
--------------------------------------------------

Код для бенчмарков лежит в папке :file:`benchmarks`. Для запуска тестов
производительности запустите скрипт :file:`benchmarks/bench.py`.

Замеры потребления памяти
-------------------------

Чтобы оптимизировать структуру словаря, нужно отслеживать потребление памяти.
Для этого у :ref:`утилиты командной строки<cli>` pymorphy есть специальная
команда::

    pymorphy dict mem_usage <FILE> [--verbose]

Для ее работы нужно предварительно установить ``psutil``::

    pip install psutil

``<FILE>`` - это файл со словарем; если указана опция ``--verbose``,
будет напечатан более детальный отчет о том, объекты каких типов занимают
сколько памяти.

.. note::

    Для работы ``--verbose`` требуется установить пакет guppy_,
    который на данный момент недоступен для python 3 (+ для работы под 2.7
    трубеутся устанавливать последнюю версию guppy из svn).

.. _guppy: http://pypi.python.org/pypi/guppy/